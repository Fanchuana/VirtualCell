data:
  name: PerturbationDataModule
  kwargs:
    toml_config_path: /work/home/cryoem666/czx/project/state_training_debug/config/new_dataset/zeroshot_k562.toml
    embed_key: X_hvg
    output_space: gene
    pert_rep: onehot
    basal_rep: sample
    num_workers: 16
    pin_memory: true
    n_basal_samples: 1
    basal_mapping_strategy: random
    should_yield_control_cells: true
    batch_col: gem_group
    pert_col: gene
    cell_type_key: cell_line
    control_pert: non-targeting
    map_controls: true
    perturbation_features_file: null
    store_raw_basal: false
    int_counts: false
    barcode: true
  output_dir: null
  debug: true
model:
  name: vae_transition
  checkpoint: null
  device: cuda
  kwargs:
    loss_kwargs:
      main_loss_kwargs:
        use_main_loss: true
        type: ba
        gene_mean: true
        sinkhorn_weight: 1
        mean_weight: 1
        cov_weight: 0
        blur: 0.05
      vae_loss_kwargs:
        use_vae_loss: true
        type: ba
        gene_mean: true
        weight: 1
        sinkhorn_weight: 1
        mean_weight: 1
        cov_weight: 0
        blur: 0.05
      DE_loss_kwargs:
        use_DE_loss: false
        type: BCE
        weight: 1
      direction_loss_kwargs:
        use_direction_loss: false
        type: MSE
        weight: 1
      cons_loss_kwargs:
        use_cons_loss: false
        type: MSE
        weight: 0.1
    vae_kwargs:
      model_path: /work/home/cryoem666/czx/project/state_training_debug/model_weight/new_dataset/state_zeroshot_VAE_k562/model_seed=0_step=199999.pt
      freeze: false
      hidden_dim: 128
    extra_dataset_kwargs:
      main_h5ad_path: /work/home/cryoem666/xyf/temp/pycharm/state/gene_perturnb_state/data/replogle.h5ad
      new_h5ad_path: /work/jpma/Mouse_fasting_project/deyu/chenzixi/replogle_deg.h5ad
      DE_gt_output_path: null
      DE_pred_output_path: null
      p_val_threshold: 0.05
    cell_set_len: 64
    hidden_dim: 328
    confidence_head: false
    n_encoder_layers: 1
    n_decoder_layers: 1
    predict_residual: true
    softplus: true
    freeze_pert_backbone: false
    transformer_decoder: false
    finetune_vci_decoder: false
    residual_decoder: false
    batch_encoder: true
    use_batch_token: false
    nb_decoder: false
    mask_attn: false
    use_effect_gating_token: false
    distributional_loss: energy
    init_from: null
    transformer_backbone_key: llama
    transformer_backbone_kwargs:
      bidirectional_attention: true
      max_position_embeddings: 64
      hidden_size: 328
      intermediate_size: 3072
      num_hidden_layers: 8
      num_attention_heads: 12
      num_key_value_heads: 12
      head_dim: 64
      use_cache: false
      attention_dropout: 0.0
      hidden_dropout: 0.0
      layer_norm_eps: 1.0e-06
      pad_token_id: 0
      bos_token_id: 1
      eos_token_id: 2
      tie_word_embeddings: false
      rotary_dim: 0
      use_rotary_embeddings: false
    lora:
      enable: false
      r: 16
      alpha: 32
      dropout: 0.05
      bias: none
      target: auto
      adapt_mlp: false
      task_type: FEATURE_EXTRACTION
      merge_on_eval: false
training:
  wandb_track: true
  weight_decay: 0.0005
  batch_size: 64
  lr: 0.0001
  max_steps: 100000
  train_seed: 42
  val_freq: 2000
  ckpt_every_n_steps: 4000
  gradient_clip_val: 10
  gradient_accumulation_steps: 1
  loss_fn: mse
  devices: 1
  strategy: auto
  use_mfu: true
  mfu_kwargs:
    available_flops: 60000000000000.0
    use_backward: true
    logging_interval: 10
    window_size: 2
  cumulative_flops_use_backward: true
wandb:
  entity: your_entity_name
  project: state
  local_wandb_dir: ./wandb_logs
  tags:
  - replogle_run_zeroshot_k562
name: zeroshot_k562
output_dir: /work/home/cryoem666/czx/project/state_training_debug/experiment/newourloss_vae_02_08/model_output/vae_genemean_cov0
use_wandb: false
overwrite: false
return_adatas: false
pred_adata_path: null
true_adata_path: null
